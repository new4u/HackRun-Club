# 对话日志 - 2026-01-30 14:49:15

## 用户需求
- 集成 PostHog 实现深度行为追踪
- 实现 4 级漏斗模型：Init -> form_open -> form_partial_fill -> form_submit
- 捕获 URL 参数用于 A/B 测试或渠道归因
- 区分用户环境（微信/Web）
- 不破坏现有 UI 样式

## 执行步骤
1.  **依赖安装**: 安装了 `posthog-js`
2.  **初始化**: 创建 `src/posthog.ts`，配置了 autocapture 和全局属性（ua_type, region）
3.  **入口引入**: 在 `index.tsx` 中调用 `initPostHog()`
4.  **CTA 追踪**:
    *   修改 `App.tsx`，在 `useEffect` 中捕获 URL 参数并发送 `$register` 事件（作为 super property 来源）
    *   在 `openSurvey` 中添加 `safeCapture('form_open', { plan })`
5.  **表单追踪**:
    *   修改 `SurveyModal.tsx`
    *   添加 `hasTriggeredPartialFill` 状态，监听表单字段变化，当 $\ge 2$ 个字段填写时触发 `form_partial_fill`
    *   在 `handleSubmit` 中触发 `form_submit`

## 涉及文件
- `package.json`
- `posthog.ts` (新建)
- `index.tsx`
- `App.tsx`
- `components/SurveyModal.tsx`

## 下一步建议
- 在后台配置 PostHog 漏斗可视化
- 替换 `posthog.ts` 中的 placeholder API Key
